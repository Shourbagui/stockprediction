<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EDA Dashboard</title>
    <style>
      :root {
        --bg: #0f172a;
        --panel: #111827;
        --card: #0b1220;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --accent: #22d3ee;
        --accent-2: #a78bfa;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 800px at 0% 0%, #0b1220 0, var(--bg) 50%), var(--bg);
        color: var(--text);
      }
      header { position: sticky; top: 0; backdrop-filter: saturate(140%) blur(6px); background: rgba(17,24,39,.6); border-bottom: 1px solid rgba(148,163,184,.15); z-index: 10; }
      .wrap { max-width: 1200px; margin: 0 auto; padding: 16px 20px; }
      .title { display: flex; align-items: center; gap: 14px; }
      .badge { padding: 2px 10px; border-radius: 999px; border: 1px solid rgba(148,163,184,.25); color: var(--muted); font-size: 12px; }
      .grid { display: grid; gap: 16px; grid-template-columns: repeat(12, 1fr); }
      .card { background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border: 1px solid rgba(148,163,184,.15); border-radius: 14px; padding: 18px 20px; }
      .card h3 { margin: 0 0 10px; font-size: 16px; color: #f3f4f6; }
      .muted { color: var(--muted); font-size: 13px; }
      .kpi { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
      .kpi .metric { background: var(--card); border: 1px solid rgba(148,163,184,.12); border-radius: 12px; padding: 14px; }
      .metric .label { color: var(--muted); font-size: 12px; }
      .metric .value { font-size: 22px; margin-top: 6px; }
      .two { grid-column: span 6; }
      .full { grid-column: span 12; }
      img { display: block; width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(148,163,184,.12); }
      a.btn { display: inline-block; padding: 10px 14px; border-radius: 10px; background: linear-gradient(90deg, var(--accent), var(--accent-2)); color: #0b1220; font-weight: 600; text-decoration: none; border: none; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
      .tall img { width: 100%; height: auto; }
      .fit { display: grid; gap: 20px; }
      .footer { color: var(--muted); font-size: 12px; text-align: center; padding: 24px 0 40px; }
      @media (max-width: 960px) {
        .two { grid-column: span 12; }
        .kpi { grid-template-columns: repeat(2, 1fr); }
        .row { grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="wrap title">
        <div style="width:10px;height:10px;border-radius:50%;background:linear-gradient(90deg,var(--accent),var(--accent-2));box-shadow:0 0 16px rgba(34,211,238,.6);"></div>
        <h2 style="margin:0;font-weight:700">EDA Dashboard</h2>
        <span class="badge">Last 10 years â€¢ 6 tickers</span>
      </div>
    </header>

    <main class="wrap" style="padding-top:20px">
      <section class="grid">
        <div class="card full">
          <div class="kpi">
            <div class="metric"><div class="label">Rows</div><div class="value" id="kpi-rows">â€”</div></div>
            <div class="metric"><div class="label">Columns</div><div class="value" id="kpi-cols">â€”</div></div>
            <div class="metric"><div class="label">Date Range</div><div class="value" id="kpi-range">â€”</div></div>
            <div class="metric"><div class="label">Tickers</div><div class="value" id="kpi-tickers">â€”</div></div>
          </div>
          <p class="muted" style="margin-top:10px">This summary reflects the cleaned slice used for EDA (recent 10 years).</p>
        </div>

        <div class="card full">
          <h3>Price change â€” last 10 years (all tickers)</h3>
          <img src="price_lines_last10y.png" alt="Price change last 10 years">
          <p class="muted" style="margin-top:10px">Close prices normalized to 100 at the start of the period. Shows relative performance across tickers.</p>
        </div>

        <div class="card two">
          <h3>Class distribution â€” label_5d</h3>
          <img src="class_distribution_label_5d.png" alt="Class distribution label_5d">
        </div>
        <div class="card two">
          <h3>Class distribution â€” prediction_20d</h3>
          <img src="class_distribution_prediction_20d.png" alt="Class distribution prediction_20d">
        </div>
        <div class="card two">
          <h3>Class distribution (pie) â€” label_5d</h3>
          <div style="display: flex; justify-content: center;">
            <img src="class_distribution_label_5d_pie.png" alt="Class distribution label_5d pie">
          </div>
        </div>
        <div class="card two">
          <h3>Class distribution (pie) â€” prediction_20d</h3>
          <div style="display: flex; justify-content: center;">
            <img src="class_distribution_prediction_20d_pie.png" alt="Class distribution prediction_20d pie">
          </div>
        </div>

        <div class="card two">
          <h3>Missingness (sampled)</h3>
          <img src="missingness_heatmap_sample.png" alt="Missingness heatmap">
          <p class="muted" style="margin-top:10px">Fundamentals and sentiment fields show high missingness in recent years; technical and price fields are dense.</p>
        </div>
        <div class="card two">
          <h3>Per-ticker label mix (label_5d)</h3>
          <img src="label5_by_ticker_stacked.png" alt="Label by ticker stacked">
          <p class="muted" style="margin-top:10px">Stacked bars show proportions of Buy/Hold/Sell per ticker.</p>
        </div>

        <div class="card full">
          <h3>Key distributions â€” Boxplots</h3>
          <img src="boxplots_key_features.png" alt="Boxplots key features">
        </div>
        <div class="card full">
          <h3>Key distributions â€” Histograms</h3>
          <img src="histograms_1.png" alt="Histograms batch 1" onerror="this.style.display='none'">
        </div>

        <div class="card full">
          <h3>MSQ fundamental metrics â€” correlation matrix</h3>
          <img src="msq_correlation_heatmap.png" alt="MSQ correlation heatmap">
          <p class="muted" style="margin-top:10px">Correlations among MSQ fundamental metrics. Helps identify redundant features and relationships between financial ratios.</p>
        </div>

        <div class="card full">
          <h3>MSQ key ratios by trading signal</h3>
          <img src="msq_boxplots_by_label.png" alt="MSQ boxplots by label">
          <p class="muted" style="margin-top:10px">Distribution of key fundamental ratios (P/E, P/B, ROE, etc.) by Buy/Hold/Sell signals.</p>
        </div>

        <div class="card full">
          <h3>MSQ return metrics by trading signal</h3>
          <img src="msq_returns_by_label.png" alt="MSQ returns by label">
          <p class="muted" style="margin-top:10px">Distribution of return metrics (ROA, ROE, ROIC) by Buy/Hold/Sell signals.</p>
        </div>

        <div class="card full">
          <h3>MSQ metrics â€” time series trends</h3>
          <img src="msq_timeseries_monthly.png" alt="MSQ timeseries">
          <p class="muted" style="margin-top:10px">Monthly averages of key fundamental metrics over time. Shows how fundamentals evolve across market cycles.</p>
        </div>

        <div class="card full">
          <h3>MSQ fundamental metrics â€” scatter relationships</h3>
          <img src="msq_scatter_matrix.png" alt="MSQ scatter matrix">
          <p class="muted" style="margin-top:10px">Scatter plots showing relationships between key valuation metrics (P/E, P/B, P/S, ROE).</p>
        </div>

        <div class="card full">
          <h3>Rolling class distribution (monthly)</h3>
          <img src="rolling_class_distribution_label5_monthly.png" alt="Rolling class distribution label_5d">
          <p class="muted" style="margin-top:10px">Monthly Buy/Hold/Sell proportions highlight regime shifts and class imbalance changes over time.</p>
        </div>

        <div class="card two">
          <h3>Mutual information (top features) â€” label_5d</h3>
          <img src="mi_topk_label5.png" alt="Mutual information top-k">
          <p class="muted" style="margin-top:10px">Nonlinear, model-agnostic importance of features vs. label_5d. See CSV for full ranking.</p>
        </div>
        <div class="card two">
          <h3>Mutual information (top features) â€” prediction_20d</h3>
          <img src="mi_topk_prediction_20d.png" alt="Mutual information top-k">
          <p class="muted" style="margin-top:10px">Nonlinear, model-agnostic importance of features vs. prediction_20d. See CSV for full ranking.</p>
        </div>

        <div class="card full">
          <h3>PCA explained variance</h3>
          <img src="pca_variance.png" alt="PCA explained variance">
          <p class="muted" style="margin-top:10px">Variance captured by the first PCs. Useful for dimensionality reduction decisions.</p>
        </div>

        <div class="card full">
          <h3>Leakage audit across lags</h3>
          <img src="leakage_audit_heatmap.png" alt="Leakage audit heatmap">
          <p class="muted" style="margin-top:10px">Correlation of feature(t+lag) with fwd_ret_5d across lags âˆ’10â€¦+10. Positive lags with high |corr| may indicate lookâ€‘ahead leakage risk.</p>
        </div>

        <div class="card full">
          <h3>ACF/PACF and rolling volatility (per ticker)</h3>
          <div class="row">
            <img src="acf_pacf_AAPL.png" alt="ACF PACF AAPL" onerror="this.style.display='none'">
            <img src="rolling_vol_AAPL.png" alt="Rolling vol AAPL" onerror="this.style.display='none'">
          </div>
          <div class="row">
            <img src="acf_pacf_MSFT.png" alt="ACF PACF MSFT" onerror="this.style.display='none'">
            <img src="rolling_vol_MSFT.png" alt="Rolling vol MSFT" onerror="this.style.display='none'">
          </div>
          <div class="row">
            <img src="acf_pacf_TSLA.png" alt="ACF PACF TSLA" onerror="this.style.display='none'">
            <img src="rolling_vol_TSLA.png" alt="Rolling vol TSLA" onerror="this.style.display='none'">
          </div>
          <p class="muted" style="margin-top:10px">Autocorrelation (ACF) and partial autocorrelation (PACF) of daily returns, plus 20â€‘day rolling volatility, provide timeâ€‘series structure diagnostics. Additional tickers available as files in this folder.</p>
        </div>

        
        <div class="card full">
          <h3>Byâ€‘label distributions â€” Boxplots</h3>
          <img src="boxplots_by_label5.png" alt="Boxplots by label">
        </div>
        <div class="card full">
          <h3>Byâ€‘label distributions â€” Violin plots</h3>
          <img src="violins_by_label5.png" alt="Violins by label">
        </div>

        <div class="card two">
          <h3>Correlation heatmap</h3>
          <img src="correlation_heatmap.png" alt="Correlation heatmap">
          <p class="muted" style="margin-top:10px">Strong coherence among moving averages; returns correlate with momentum/RSI features.</p>
        </div>
        <div class="card two" style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <div>
            <h3 style="margin-bottom:6px">Full interactive profile</h3>
            <p class="muted" style="margin:0 0 10px">Open the complete ydata profile for detailed variable stats and alerts.</p>
            <a class="btn" href="ydata_profile.html" target="_blank" rel="noreferrer">Open full report</a>
          </div>
          <img src="histograms_2.png" alt="Histograms batch 2" style="max-width:48%" onerror="this.style.display='none'">
        </div>

        <div class="card two" style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px">
          <div style="width:100%">
            <h3 style="margin-bottom:6px">Classification report â€” prediction_20d</h3>
            <p class="muted" style="margin:0 0 10px">Click to fetch the latest model classification report and render it here.</p>
            <button id="btn-load-cls" style="background:#1d4ed8;color:#e2e8f0;border:1px solid rgba(59,130,246,.7);border-radius:8px;padding:8px 12px;cursor:pointer">Get classification report</button>
            <div id="cls-report" style="margin-top:12px;overflow:auto"></div>
          </div>
        </div>
      </section>

      <section class="footer">
        Generated locally â€¢ Links to CSVs and PNGs in this folder.
        <br><br>
        <a href="../classification/index.html" style="color: #60a5fa; text-decoration: none; border-bottom: 1px solid #60a5fa; padding-bottom: 2px;">ðŸ¤– View Classification Model Results â†’</a>
      </section>
    </main>

    <script>
      async function loadCSV(path){
        const res = await fetch(path);
        if(!res.ok) return null;
        const text = await res.text();
        return text.trim().split(/\r?\n/).map(l=>l.split(","));
      }
      (async()=>{
        const el = (id, v)=>{ const n = document.getElementById(id); if(n) n.textContent = v; };
        try {
          const overview = await loadCSV('overview.csv');
          if(overview){
            const map = Object.fromEntries(overview.slice(1).map(([k,v])=>[k,v]));
            el('kpi-rows', map['num_rows'] || 'â€”');
            el('kpi-cols', map['num_columns'] || 'â€”');
            const range = `${(map['date_min']||'').slice(0,10)} â†’ ${(map['date_max']||'').slice(0,10)}`;
            el('kpi-range', range.includes('â†’') ? range : 'â€”');
            el('kpi-tickers', map['num_tickers'] || 'â€”');
          }

        } catch (e) {
          // If running via file://, fetch may be blocked. Show hint.
          const hint = document.createElement('div');
          hint.className = 'muted';
          hint.style.marginTop = '10px';
          hint.textContent = 'Tip: if KPIs are blank, open this page via http://localhost (python -m http.server) so CSV loading works.';
          document.querySelector('.wrap').prepend(hint);
        }
      })();

      async function loadClassificationReportIntoDashboard(){
        const mount = document.getElementById('cls-report');
        if(!mount) return;
        mount.innerHTML = '<div class="muted">Loading classification report...</div>';
        try {
          const res = await fetch('/classification/classification_report.json');
          if(!res.ok) throw new Error('Not found');
          const report = await res.json();

          let html = '<div class="table-container"><table><thead><tr><th>Class</th><th>Precision</th><th>Recall</th><th>F1-Score</th><th>Support</th></tr></thead><tbody>';
          for (const [label, vals] of Object.entries(report)){
            if (['accuracy','macro avg','weighted avg'].includes(label)) continue;
            html += `<tr><td>${label}</td><td>${(vals.precision*100).toFixed(2)}%</td><td>${(vals.recall*100).toFixed(2)}%</td><td>${(vals['f1-score']*100).toFixed(2)}%</td><td>${vals.support}</td></tr>`;
          }
          if (report['macro avg']){
            const v = report['macro avg'];
            html += `<tr style="font-weight:600;background:rgba(148,163,184,.08)"><td>Macro avg</td><td>${(v.precision*100).toFixed(2)}%</td><td>${(v.recall*100).toFixed(2)}%</td><td>${(v['f1-score']*100).toFixed(2)}%</td><td>${v.support}</td></tr>`;
          }
          html += '</tbody></table></div>';
          mount.innerHTML = html;
        } catch (e){
          mount.innerHTML = '<div class="muted">Classification report not found. Run the model first (see classification/).</div>';
        }
      }

      const btn = document.getElementById('btn-load-cls');
      if (btn) {
        btn.addEventListener('click', () => {
          window.open('/reports/classification/index.html', '_blank');
        });
      }
    </script>
  </body>
  </html>


